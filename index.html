<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„æºåˆ†äº«ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŸ èµ„æºåˆ†äº«ä¸­å¿ƒ</h1>
            <p>ç²¾é€‰ä¼˜è´¨èµ„æºï¼Œå®‰å…¨å¿«é€Ÿä¸‹è½½</p>
        </div>

        <div class="resources" id="resourcesList">
            <div class="resource-item" onclick="openPasswordModal('resource1')">
                <div class="resource-title">ğŸ“± æ‰‹æœºåº”ç”¨åˆé›†</div>
                <div class="resource-desc">åŒ…å«å„ç±»å®ç”¨æ‰‹æœºåº”ç”¨ï¼Œå·²å»å¹¿å‘Šä¼˜åŒ–ç‰ˆæœ¬</div>
                <div class="resource-info">
                    <span class="resource-size">å¤§å°: 2.3 GB</span>
                    <span class="resource-date">æ›´æ–°: 2024-05-28</span>
                </div>
            </div>

            <div class="resource-item" onclick="openPasswordModal('resource2')">
                <div class="resource-title">ğŸ¬ é«˜æ¸…ç”µå½±èµ„æº</div>
                <div class="resource-desc">æœ€æ–°çƒ­é—¨ç”µå½±ï¼Œ4Kè“å…‰åŸç›˜è´¨é‡</div>
                <div class="resource-info">
                    <span class="resource-size">å¤§å°: 15.6 GB</span>
                    <span class="resource-date">æ›´æ–°: 2024-05-27</span>
                </div>
            </div>

            <div class="resource-item" onclick="openPasswordModal('resource3')">
                <div class="resource-title">ğŸ“š å­¦ä¹ èµ„æ–™åŒ…</div>
                <div class="resource-desc">ç¼–ç¨‹ã€è®¾è®¡ã€è¯­è¨€å­¦ä¹ ç­‰å„ç±»æ•™ç¨‹èµ„æ–™</div>
                <div class="resource-info">
                    <span class="resource-size">å¤§å°: 8.9 GB</span>
                    <span class="resource-date">æ›´æ–°: 2024-05-26</span>
                </div>
            </div>

            <div class="resource-item" onclick="openPasswordModal('resource4')">
                <div class="resource-title">ğŸµ æ— æŸéŸ³ä¹ä¸“è¾‘</div>
                <div class="resource-desc">FLACæ ¼å¼æ— æŸéŸ³è´¨ï¼Œæ¶µç›–å„ç§éŸ³ä¹é£æ ¼</div>
                <div class="resource-info">
                    <span class="resource-size">å¤§å°: 12.4 GB</span>
                    <span class="resource-date">æ›´æ–°: 2024-05-25</span>
                </div>
            </div>

            <div class="resource-item" onclick="openPasswordModal('resource5')">
                <div class="resource-title">ğŸ’» åŠå…¬è½¯ä»¶å¥—è£…</div>
                <div class="resource-desc">Adobeå…¨å®¶æ¡¶ã€Officeå¥—ä»¶ç­‰ä¸“ä¸šè½¯ä»¶</div>
                <div class="resource-info">
                    <span class="resource-size">å¤§å°: 6.7 GB</span>
                    <span class="resource-date">æ›´æ–°: 2024-05-24</span>
                </div>
            </div>
        </div>

        <div class="message-board">
            <div class="message-header">
                <h2>ğŸ’¬ èµ„æºç•™è¨€æ¿</h2>
                <p>éœ€è¦ä»€ä¹ˆèµ„æºï¼Ÿåœ¨è¿™é‡Œå‘Šè¯‰æˆ‘ä»¬å§ï¼</p>
            </div>
            
            <div class="message-form">
                <div class="form-group">
                    <input type="text" id="userName" class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°">
                </div>
                <div class="form-group">
                    <textarea id="userMessage" class="form-textarea" placeholder="è¯·æè¿°æ‚¨éœ€è¦çš„èµ„æºç±»å‹ã€åç§°ç­‰è¯¦ç»†ä¿¡æ¯..." rows="4"></textarea>
                </div>
                <button class="btn btn-gradient" id="submitMessageBtn">
                    <span>ğŸ“ æäº¤ç•™è¨€</span>
                </button>
            </div>

            <div class="messages-list" id="messagesList">
                <h3>ğŸ“‹ æœ€æ–°ç•™è¨€</h3>
                <!-- ç•™è¨€å°†ç”±FirebaseåŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <div class="footer">
            <p>ğŸ“§ å¦‚æœ‰é—®é¢˜è¯·è”ç³»ç®¡ç†å‘˜ | ğŸ”’ æ‰€æœ‰èµ„æºå‡ç»è¿‡å®‰å…¨æ£€æµ‹</p>
        </div>
    </div>

    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ” è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
            </div>
            <div class="modal-body">
                <input type="password" id="passwordInput" class="password-input" placeholder="è¯·è¾“å…¥4ä½æ•°å­—å¯†ç " maxlength="4">
                <div class="error-message" id="errorMessage">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="verifyPassword()">ç¡®è®¤</button>
                </div>
            </div>
        </div>
    </div>

    <div id="successPage" class="modal">
        <div class="modal-content">
            <div class="success-page">
                <div class="success-icon">âœ…</div>
                <h3>å¯†ç æ­£ç¡®ï¼</h3>
                <p>ä»¥ä¸‹æ˜¯æ‚¨çš„ä¸‹è½½é“¾æ¥ï¼š</p>
                <div class="download-links" id="downloadLinks">
                </div>
                <button class="btn btn-primary" onclick="closeSuccessPage()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyAOBvOeOWkRWWssJ0V0c-ge4j_YgNT2_Z4",
            authDomain: "resource-sharing-center.firebaseapp.com",
            projectId: "resource-sharing-center",
            storageBucket: "resource-sharing-center.firebasestorage.app",
            messagingSenderId: "846208459960",
            appId: "1:846208459960:web:b874dc71135c1217be004d",
            measurementId: "G-W606DJX5LW"
        };

        // å¯¼å…¥Firebaseæ¨¡å—
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // åˆå§‹åŒ–Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const messagesRef = collection(db, "messages");

        // æäº¤ç•™è¨€
        document.getElementById('submitMessageBtn').addEventListener('click', async () => {
            const userName = document.getElementById('userName').value.trim();
            const userMessage = document.getElementById('userMessage').value.trim();

            if (!userName || !userMessage) {
                alert('è¯·å¡«å†™å®Œæ•´çš„æ˜µç§°å’Œç•™è¨€å†…å®¹ï¼');
                return;
            }

            try {
                await addDoc(messagesRef, {
                    author: userName,
                    content: userMessage,
                    timestamp: serverTimestamp()
                });

                // æ¸…ç©ºè¡¨å•
                document.getElementById('userName').value = '';
                document.getElementById('userMessage').value = '';

                // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                showSuccessNotification();
            } catch (error) {
                console.error("æäº¤ç•™è¨€å¤±è´¥: ", error);
                alert('ç•™è¨€æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
            }
        });

        // å®æ—¶åŠ è½½ç•™è¨€
        const q = query(messagesRef, orderBy("timestamp", "desc"));
        const unsubscribe = onSnapshot(q, (snapshot) => {
            const messagesList = document.getElementById('messagesList');
            // æ¸…ç©ºç°æœ‰ç•™è¨€ï¼ˆä¿ç•™æ ‡é¢˜ï¼‰
            messagesList.innerHTML = '<h3>ğŸ“‹ æœ€æ–°ç•™è¨€</h3>';
            
            snapshot.forEach((doc) => {
                const messageData = doc.data();
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                
                // æ ¼å¼åŒ–æ—¶é—´æˆ³
                const timestamp = messageData.timestamp?.toDate 
                    ? new Date(messageData.timestamp.toDate()).toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                    : 'åˆšåˆš';
                
                messageItem.innerHTML = `
                    <div class="message-meta">
                        <span class="message-author">ğŸ‘¤ ${messageData.author}</span>
                        <span class="message-time">${timestamp}</span>
                    </div>
                    <div class="message-content">${messageData.content}</div>
                `;
                messagesList.appendChild(messageItem);
            });
        });

        // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
        function showSuccessNotification() {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = 'âœ… ç•™è¨€æäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„éœ€æ±‚ã€‚';
            
            const messageForm = document.querySelector('.message-form');
            messageForm.parentNode.insertBefore(notification, messageForm);

            notification.style.display = 'block';

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
    </script>

    <script src="script.js"></script>
</body>
</html>
